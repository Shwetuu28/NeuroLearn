<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NeuroLearn — AI Tutor Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --brand: #6366f1;
      --brand-dark: #5b47f4;
      --accent: #2563eb;
      --muted: #94a3b8;
      --bg: #f6f8fb;
      --card-bg: #ffffff;
    }

    /* PAGE LAYOUT */
    html,body { height:100%; }
    body {
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: var(--bg);
      margin: 0;
      display:flex;
      flex-direction:column;
      min-height:100vh;
      color: #0f172a;
      -webkit-font-smoothing:antialiased;
    }

    /* HEADER */
    header.global-header {
      background: #2563eb;
      border-bottom: 4px solid var(--brand);
      box-shadow: 0 2px 8px rgba(10,20,40,0.04);
      position: sticky;
      top: 0;
      z-index: 60;
    }
    .header-inner {
      max-width:1200px;
      margin: 0 auto;
      padding: 14px 20px;
      display:flex;
      align-items:center;
      gap:16px;
      justify-content:space-between;
    }
    .brand {
      display:flex;
      gap:12px;
      align-items:center;
      text-decoration:none;
      color:var(--brand-dark);
    }
    .brand .logo {
      width:40px; height:40px; border-radius:8px;
      background: linear-gradient(135deg,var(--brand),var(--brand-dark));
      color:white; display:flex; align-items:center; justify-content:center; font-weight:800;
      box-shadow: 0 6px 18px rgba(197, 201, 202, 0.12);
      font-size:16px;
    }
    .nav { display:flex; gap:20px; align-items:center; }
    .nav a { text-decoration:none; color:#ebedf1; font-weight:600; padding:8px 6px; border-radius:6px; }
    .nav a:hover { background: rgba(99,102,241,0.06); color:var(--brand-dark); }

    /* MAIN - center the tutor card */
    main.site-main {
      flex: 1 1 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 28px 16px;
    }

    /* CHAT CARD (tutor) */
    .chat-card {
      width:100%;
      max-width:820px;
      height: calc(78vh);
      background: linear-gradient(180deg, rgba(255,255,255,0.98), #fbfbff 60%);
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(12,18,55,0.12);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      border: 1px solid rgba(99,102,241,0.06);
    }

    .chat-meta {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 16px;
      background: linear-gradient(90deg, var(--brand), var(--brand-dark));
      color:#fff;
      font-weight:700;
      box-shadow: 0 4px 12px rgba(99,102,241,0.12);
    }

    #chat-container {
      flex:1;
      padding:18px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      background: linear-gradient(180deg,#eef2ff 0%, #ffffff 100%);
    }
    .chat-row { display:flex; gap:10px; align-items:flex-start; }
    .chat-bubble {
      border-radius:12px;
      padding:12px 14px;
      max-width:78%;
      word-wrap:break-word;
      box-shadow: 0 6px 14px rgba(2,6,23,0.06);
      position:relative;
      animation: fadeIn .18s ease forwards;
      line-height:1.45;
      white-space:pre-wrap;
    }
    .chat-bubble.ai { background:var(--card-bg); align-self:flex-start; color:#0f172a; }
    .chat-bubble.user { background:var(--accent); color:white; align-self:flex-end; }
    .avatar { width:36px; height:36px; border-radius:50%; flex-shrink:0; }

    @keyframes fadeIn { from {opacity:0; transform: translateY(6px)} to {opacity:1; transform: translateY(0)} }

    /* Controls */
    .controls {
      padding:12px;
      background:transparent;
      border-top:1px solid rgba(14,20,40,0.03);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .input-row { display:flex; gap:10px; align-items:center; }
    input#user-input {
      flex:1;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(14,20,40,0.06);
      outline:none;
      font-size:15px;
      background:#fff;
      box-shadow: inset 0 1px 0 rgba(2,6,23,0.02);
    }

    .action-row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }

    /* Bounce cards (buttons) */
    .bounce-card {
      background:white;
      padding:10px 14px;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.28s cubic-bezier(.2,.9,.3,1), box-shadow 0.28s, background 0.28s, color 0.28s;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:600;
      color:#0f172a;
      user-select:none;
    }
    .bounce-card:hover { transform: translateY(-8px); box-shadow:0 10px 26px rgba(14,20,40,0.14); background:var(--brand); color:white; }
    .bounce-card.explain { color:#7c2cff; }
    .bounce-card.translate { color:#059669; }
    .bounce-card.summarize { color:#6d28d9; }
    .bounce-card.save { color:#ef4444; }
    .bounce-card.explain:hover { background:#5b47f4; }
    .bounce-card.translate:hover { background:#10b981; }
    .bounce-card.summarize:hover { background:#7c3aed; }
    .bounce-card.save:hover { background:#ef4444; }

    .note { font-size:13px; color:var(--muted); margin-left:6px; }

    /* Footer (wide purple bar) */
    footer.global-footer {
      background: var(--brand);
      color: #fff;
      padding:18px 16px;
      margin-top: 20px;
    }
    .footer-inner {
      max-width:1200px;
      margin: 0 auto;
      display:flex;
      justify-content:center;
      align-items:center;
      gap:12px;
    }

    /* responsive */
    @media (max-width:900px) {
      .chat-card { max-width:95%; height:82vh; }
      .header-inner { padding:12px; }
      .nav { display:none; }
    }
    @media (max-width:520px) {
      .chat-card { height:88vh; }
      .bounce-card { padding:10px; font-size:14px; }
      .header-inner { gap:8px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="global-header" role="banner" aria-label="Site header">
    <div class="header-inner">
      <a class="brand" href="#">
        <div>
          <div style="font-size:19px; color:var(--muted); -webkit-text-fill-color:white;"><b>AI Tutor</b> </div>
        </div>
      </a>

      <nav class="nav" role="navigation" aria-label="Top navigation">
        <a href="index.html" class="text-white">Home</a>
        <a href="index.html#about" >About</a>
        <a href="dashboard.html" >Dashboard</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="site-main" role="main">
    <section class="chat-card" aria-label="AI Tutor">
      <div class="chat-meta">
        <div>NeuroLearn — AI Tutor</div>
        <div id="status-meta">Demo Mode</div>
      </div>

      <div id="chat-container" aria-live="polite">
        <div class="chat-row">
          <img src="https://i.ibb.co/3Fj6HqZ/ai-avatar.png" class="avatar" alt="AI avatar">
          <div class="chat-bubble ai">Hello! I'm your AI tutor — click "Explain Simply" or "Translate" after typing a question.</div>
        </div>
      </div>

      <div class="controls" role="region" aria-label="Chat controls">
        <div class="input-row">
          <input id="user-input" type="text" placeholder="Type your question here (e.g., What is photosynthesis?)" aria-label="Question input">
        </div>

        <div class="action-row" role="toolbar" aria-label="Chat actions">
          <div id="explain-btn" class="bounce-card explain" role="button" tabindex="0"><span>Explain Simply</span></div>
          <div id="translate-btn" class="bounce-card translate" role="button" tabindex="0"><span>Translate</span></div>
          <div id="summarize-btn" class="bounce-card summarize" role="button" tabindex="0"><span>Summarize</span></div>
          <div id="save-btn" class="bounce-card save" role="button" tabindex="0"><span>Save to Profile</span></div>
          <div class="note" id="note-area">Language: <span id="lang-name">English</span></div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="global-footer" role="contentinfo" aria-label="Footer">
    <div class="footer-inner">
      <div style="font-size:14px; font-weight:700">© <span id="year"></span> NeuroLearn</div>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ========== Chat JS (kept from your file) ========== */
    const API_BASE = 'http://localhost:4000';
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');
    const explainBtn = document.getElementById('explain-btn');
    const translateBtn = document.getElementById('translate-btn');
    const summarizeBtn = document.getElementById('summarize-btn');
    const saveBtn = document.getElementById('save-btn');
    const langName = document.getElementById('lang-name');

    let lastAIMessage = '';
    let lastUserMessage = '';
    let currentLanguage = 'English';

    function addMessage(text, sender='ai'){
      const row = document.createElement('div');
      row.className = 'chat-row';
      if(sender === 'user'){
        const bubble = document.createElement('div');
        bubble.className = 'chat-bubble user';
        bubble.innerText = text;
        bubble.style.alignSelf = 'flex-end';
        row.style.justifyContent = 'flex-end';
        row.appendChild(bubble);
      } else {
        const img = document.createElement('img');
        img.src = 'https://i.ibb.co/3Fj6HqZ/ai-avatar.png';
        img.className = 'avatar';
        row.appendChild(img);
        const bubble = document.createElement('div');
        bubble.className = 'chat-bubble ai';
        bubble.innerText = text;
        row.appendChild(bubble);
      }
      chatContainer.appendChild(row);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTypingIndicator(){
      const id = 'typing-indicator';
      const el = document.createElement('div');
      el.id = id;
      el.className = 'chat-row';
      const img = document.createElement('img'); img.src = 'https://i.ibb.co/3Fj6HqZ/ai-avatar.png'; img.className='avatar';
      el.appendChild(img);
      const bubble = document.createElement('div'); bubble.className='chat-bubble ai';
      bubble.innerHTML = '<span class="typing"></span><span class="typing"></span><span class="typing"></span>';
      el.appendChild(bubble);
      chatContainer.appendChild(el);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return el;
    }
    function removeTypingIndicator(el){ if(el && el.parentNode) el.parentNode.removeChild(el); }

    function localAIResponse(message, action='explain', language='English'){
      if(action === 'translate'){
        return `${message}\n\nTranslation:\n\n[${language} translation of "${message}"]`;
      }
      if(action === 'explain'){
        return `${message}\n\nExplanation:\n\n[Simple explanation of "${message}"]`;
      }
      if(action === 'summarize'){
        return `Summary:\n\n[Short summary of "${message}"]`;
      }
      return message;
    }

    async function callAiBackend(message, action, language){
      try {
        const resp = await fetch(`${API_BASE}/api/chat`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ message, action, language })
        });
        if(!resp.ok) throw new Error('Backend returned ' + resp.status);
        const data = await resp.json();
        if(data.reply) return data.reply;
        if(data.normal || data.simplified) {
          return `${message}\n\n${action === 'translate' ? 'Translation:' : action === 'explain' ? 'Explanation:' : 'Summary:'}\n\n${data.normal || data.simplified}`;
        }
        return JSON.stringify(data);
      } catch (err) {
        console.warn('AI backend failed, using fallback', err.message);
        return localAIResponse(message, action, language);
      }
    }

    explainBtn.addEventListener('click', async () => {
      const message = userInput.value.trim();
      if(!message) return alert('Type a message first');
      lastUserMessage = message;
      addMessage(message, 'user');
      const typingEl = showTypingIndicator();
      const reply = await callAiBackend(message, 'explain', currentLanguage);
      removeTypingIndicator(typingEl);
      let finalText = `${message}\n\nExplanation:\n\n${reply.replace(/^\s+|\s+$/g,'')}`;
      if(reply.toLowerCase().includes('explanation:') || reply.toLowerCase().includes('translation:')) {
        finalText = reply;
      }
      addMessage(finalText, 'ai');
      lastAIMessage = finalText;
      userInput.value = '';
    });

    translateBtn.addEventListener('click', async () => {
      const message = userInput.value.trim();
      if(!message) return alert('Type a message first');
      const lang = prompt('Enter target language (e.g., Hindi, Spanish)', 'Hindi');
      if(!lang) return;
      currentLanguage = lang;
      langName.innerText = currentLanguage;
      lastUserMessage = message;
      addMessage(message, 'user');
      const typingEl = showTypingIndicator();
      const reply = await callAiBackend(message, 'translate', currentLanguage);
      removeTypingIndicator(typingEl);
      let finalText = `${message}\n\nTranslation:\n\n${reply.replace(/^\s+|\s+$/g,'')}`;
      if(reply.toLowerCase().includes('translation:') || reply.toLowerCase().includes('explanation:')) {
        finalText = reply;
      }
      addMessage(finalText, 'ai');
      lastAIMessage = finalText;
      userInput.value = '';
    });

    summarizeBtn.addEventListener('click', async () => {
      const message = lastAIMessage || userInput.value.trim();
      if(!message) return alert('No message to summarize');
      addMessage(message, 'user');
      const typingEl = showTypingIndicator();
      const reply = await callAiBackend(message, 'summarize', currentLanguage);
      removeTypingIndicator(typingEl);
      const finalText = `Summary:\n\n${reply.replace(/^\s+|\s+$/g,'')}`;
      addMessage(finalText, 'ai');
      lastAIMessage = finalText;
    });

    saveBtn.addEventListener('click', async () => {
      if(!lastUserMessage || !lastAIMessage) {
        return alert('No recent Q/A to save. Ask something and then click Save to Profile.');
      }
      const outputs = {
        normal: lastAIMessage,
        simplified: lastAIMessage.split('\n').slice(0,3).join(' '),
        flashcards: [
          { q: 'Q: What was asked?', a: `A: ${lastUserMessage}` },
          { q: 'Q: Key idea?', a: `A: ${lastAIMessage.split('\n').slice(-1)[0] || lastAIMessage}` }
        ]
      };
      const payload = {
        userId: 'demo',
        title: `Saved: ${lastUserMessage.slice(0,40)}`,
        originalText: lastUserMessage,
        profile: { attention:50, reading:'text', support:'Default' },
        outputs
      };
      try {
        const res = await fetch(`${API_BASE}/api/profile/summaries`, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('Save failed: ' + res.status);
        const data = await res.json();
        addMessage('✅ Saved to Profile', 'ai');
      } catch (err) {
        console.warn('Save failed, showing local confirmation', err.message);
        addMessage('✅ (Local) Saved to Profile (demo)', 'ai');
      }
    });

    // Enter triggers Explain
    userInput.addEventListener('keypress', (e) => {
      if(e.key === 'Enter') {
        e.preventDefault();
        explainBtn.click();
      }
    });

    // initial focus
    userInput.focus();
  </script>
</body>
</html>
